var CMSPlugin={window:this.window,requires:["iframedialog","fakeobjects"],currentEditor:null,lang:["en"],regNumber:/^\d+(?:\.\d+)?$/,regFlashFilename:/\.swf(?:$|\?)/i,selection:null,selectedElement:null,selectionBookmarks:null,cssifyLength:function(e){return CMSPlugin.regNumber.test(e)?e+"px":e},createFakeControl:function(e,t){if(null!==e){var i,n=null,a=e.attributes.type,r=a?a.toLowerCase():"unknown";switch(r){case"youtubevideo":(n=t.createFakeParserElement(e,"cke_youtube","object",!0)).attributes.cms_youtube="true",n.attributes.cms_disable_media="true";break;case"flash":case"media":"flash"===this.getMediaType(e,t)||"flash"===r?(n=t.createFakeParserElement(e,"cke_flash","object",!0)).attributes.cms_media="true":(n=t.createFakeParserElement(e,"cke_media","video",!0)).attributes.cms_media="true";break;case"mediafilecontrol":(n=t.createFakeParserElement(e,"cke_old_media","object",!0)).attributes.cms_media="true";break;case"image":e.attributes.width&&parseInt(e.attributes.width,10)>0&&e.attributes.height&&parseInt(e.attributes.height,10)>0||(i=this.getElementObject(e))&&((!e.attributes.width||parseInt(e.attributes.width,10)<=0)&&(!e.attributes.height||parseInt(e.attributes.height,10)<=0)?(e.attributes.width=i.originalwidth,e.attributes.height=i.originalheight):!e.attributes.height||parseInt(e.attributes.height,10)<=0?e.attributes.height=Math.round(e.attributes.width/(parseFloat(i.originalwidth)/i.originalheight)):(!e.attributes.width||parseInt(e.attributes.width,10)<=0)&&(e.attributes.width=Math.round(e.attributes.height/(parseFloat(i.originalheight)/i.originalwidth)))),(n=t.createFakeParserElement(e,"cke_image","object",!0)).attributes.cms_media="true";var l=this.getImageUrl(e,t);l&&(n.attributes.src=l);break;case"widget":if(i=this.getElementObject(e),(n=t.createFakeParserElement(e,"cke_widget","object",!0)).attributes.cms_disable_media="true",n.attributes.cke_widget="true",i.image_guid&&(s=n.attributes.style||"",n.attributes.style=s+"background-image:url("+t.config.ApplicationPath+"CMSPages/GetMetaFile.aspx?fileguid="+i.image_guid+"&maxsidesize=32);"),i.widget_displayname){var o=i.widget_displayname.replace(/\+/g," ");n.attributes.title=decodeURIComponent(o)}break;default:(n=t.createFakeParserElement(e,"cke_inlinecontrol","object",!1)).attributes.cms_disable_media="true"}n.attributes.cms_inline="true",n.attributes.alt="";var s=n.attributes.style||"",u=e.attributes.width,c=e.attributes.height;return"widget"!=r&&(n.attributes.title="",void 0!==u&&(s=n.attributes.style=s+"width:"+this.cssifyLength(u)+";"),void 0!==c&&(s=n.attributes.style=s+"height:"+this.cssifyLength(c)+";")),n}return null},getNodeList:function(e){return new CKEDITOR.dom.nodeList(e)},getElementObject:function(e){var t,i,n,a={};if(e)if(e._)for(n=0;n<e.children.length;n++)t=e.children[n].attributes.name,i=e.children[n].attributes.value,a[t]=i;else for(n=0;n<e.children.length;n++)t=e.children[n].getAttribute("name"),i=e.children[n].getAttribute("value"),a[t]=i;return a},getCurrentEditor:function(){return null!==this.currentEditor?this.currentEditor:null!==CKEDITOR.currentInstance?CKEDITOR.currentInstance:null},getImageUrl:function(e,t){t=t||this.getCurrentEditor();var i=null,n=CMSPlugin.getElementObject(e);return n.url&&0===(i=n.url).indexOf("~/")&&(i=i.replace("~/",t.config.ApplicationPath)),i},getMediaType:function(e){var t=this.getElementObject(e);return t.cms_type?t.cms_type.toLowerCase():t.ext&&".swf"===t.ext.toLowerCase()||CMSPlugin.isFlashEmbed(e)?"flash":"audiovideo"},isFlashEmbed:function(e){var t=e.attributes;return"application/x-shockwave-flash"==t.type||"flash"==t.type||CMSPlugin.regFlashFilename.test(t.src||"")},initCss:function(e){var t="background-position: center center;background-repeat: no-repeat;border: 1px solid #CCC;width: 80px;height: 80px;";CKEDITOR.addCss("img.cke_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMedia_bg.png")+");"+t+"}"),CKEDITOR.addCss("img.cke_flash { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertFlash_bg.png")+");"+t+"}"),CKEDITOR.addCss("img.cke_old_media { background-image: url("+CKEDITOR.getUrl(e.config.CMSPluginUrl+"images/InsertImageOrMediaOld_bg.png")+");"+t+"}")},openWidget:function(e,t,i,n,a){this.currentEditor=e;var r,l=e.getSelection().getSelectedElement();if(r=e.config.IsLiveSite?e.config.ApplicationPath+"CMSModules/Widgets/LiveDialogs/"+t:e.config.ApplicationPath+"CMSModules/Widgets/Dialogs/"+t,l&&l.hasAttribute("cms_inline")){var o=e.restoreRealElement(l),s=this.getInline(o.$);if("widget"===s.cms_type&&(null===i||i===s.name)){var u=e.config.CurrentAliasPath?e.config.CurrentAliasPath:"";r=e.config.ApplicationPath+(e.config.IsLiveSite?"CMSModules/Widgets/LiveDialogs/WidgetProperties.aspx":"CMSModules/Widgets/Dialogs/WidgetProperties.aspx"),r+="?inline=true&aliaspath="+u,n=900,a=650}}CMSPlugin.openModalDialog(r,i,n,a)},pluginInsertMacro:function(e){var t="InsertMacro",i="";e.config.ResolverName&&(i="resolver="+e.config.ResolverName),e.config.CurrentDocumentID&&(i&&(i+="&"),i+="documentid="+e.config.CurrentDocumentID),e.config.CurrentCulture&&(i&&(i+="&"),i+="culture="+e.config.CurrentCulture);var n={exec:function(e){CMSPlugin.currentEditor=e;var t=e.config.ApplicationPath+"CMSAdminControls/UI/Macros/Dialogs/Default.aspx?"+i;CMSPlugin.openModalDialog(t,"insertMacro",1024,660)}},a={label:e.lang.CMSPlugins.InsertMacro.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"};e.ui.addButton(t,a),e.addCommand(t,n)},pluginKeyPress:function(e){e.on("instanceReady",(function(e){var t=function(e){return e.ctrlKey&&e.altKey},i=function(e){if(!window.disableShortcuts){if(window.HtmlEditor)return window.HtmlEditor.keyPressed(e);if(null!==window.parent&&window.parent.HtmlEditor)return window.parent.HtmlEditor.keyPressed(e)}return!0},n=function(e){var t=e.data,i=t.$;return t.key=t.getKey(),t.ctrlKey=i.ctrlKey,t.altKey=i.altKey,t.shiftKey=i.shiftKey,t},a=function(e){var a=n(e);t(a)||i(a)},r=function(e){var a=n(e);t(a)&&i(a)};e.editor.document.on("keydown",a),e.editor.document.on("keyup",r),e.editor.on("mode",(function(e){var t=e.editor;"source"!==t.mode&&(t.document.on("keydown",a),t.document.on("keyup",r))}))}))},pluginInsertImageOrMedia:function(e){var t="InsertImageOrMedia",i={exec:function(e){var t=window.unescape(e.config.MediaDialogWidth),i=window.unescape(e.config.MediaDialogHeight);CMSPlugin.currentEditor=e,CMSPlugin.openModalDialog(e.config.MediaDialogURL,"imageormedia",t,i)}},n={label:e.lang.CMSPlugins.InsertImageOrMedia.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},a={imageormedia:{label:e.lang.CMSPlugins.InsertImageOrMedia.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,i),e.ui.addButton(t,n),e.on("doubleclick",(function(e){var i=e.data.element;if(e.editor.config.removeButtons)for(var n in e.editor.config.removeButtons)if("InsertImageOrMedia"===e.editor.config.removeButtons[n])return void e.cancel();!i.is("img")||"true"!==i.getAttribute("cms_media")&&i.data("cke-realelement")||(e.editor.execCommand(t),e.cancel())}),null,null,1),e.addMenuItems&&(e.addMenuGroup(t),e.addMenuItems(a)),e.contextMenu&&e.contextMenu.addListener((function(e){if(e&&e.is("img")&&"cke_anchor"!=e.getAttribute("class")&&"flash"!=e.data("cke-real-element-type")&&("true"==e.getAttribute("cms_media")||"true"!=e.getAttribute("cms_disable_media")))return{imageormedia:CKEDITOR.TRISTATE_OFF}})),e.on("toHtml",(function(e){var t=e.data.dataValue,i=e.editor.config.AppendToImagePath;void 0!==i&&i.length>0&&function e(t){t.children&&t.children.forEach(e);if("img"==t.name&&void 0!==t.attributes.src&&-1===t.attributes.src.indexOf("data:image")){var n=t.attributes.src;-1==n.indexOf("?")&&(n+="?"),n+="&"+i,t.attributes.src=n}}(t)}))},pluginInsertLink:function(e){var t="InsertLink",i={exec:function(e){var t=window.unescape(e.config.LinkDialogWidth),i=window.unescape(e.config.LinkDialogHeight);CMSPlugin.currentEditor=e,CMSPlugin.openModalDialog(e.config.LinkDialogURL,"imageormedia",t,i)}},n={label:e.lang.CMSPlugins.InsertLink.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},a={insertLink:{label:e.lang.CMSPlugins.InsertLink.menu,command:t,group:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"}};e.addCommand(t,i,1),e.ui.addButton(t,n),e.on("doubleclick",(function(i){var n;try{n=CKEDITOR.plugins.link.getSelectedLink(e)||i.data.element}catch(e){}if(i.editor.config.removeButtons)for(var a in i.editor.config.removeButtons)if("InsertLink"===i.editor.config.removeButtons[a])return void i.cancel();n&&(n.isReadOnly()||"Disabled"==i.editor.config.toolbar?i.stop():n.is("a")?n.getAttribute("name")&&!n.getAttribute("href")?i.data.dialog="anchor":(i.editor.execCommand(t),i.cancel()):n.is("img")&&"anchor"==n.data("cke-real-element-type")&&(i.data.dialog="anchor"))}),null,null,1),e.addMenuItems&&(e.addMenuGroup(t),e.addMenuItems(a)),e.contextMenu&&e.contextMenu.addListener((function(t){if(!t||t.isReadOnly())return null;var i=t.is("img")&&"anchor"==t.data("cke-real-element-type");if(!i){if(!(t=CKEDITOR.plugins.link.getSelectedLink(e)))return null;i=t.getAttribute("name")&&!t.getAttribute("href")}return i?void 0:{insertLink:CKEDITOR.TRISTATE_OFF}}))},pluginQuicklyInsertMedia:function(e){var t="QuicklyInsertImage",i={exec:function(e){CMSPlugin.currentEditor=e,CMSPlugin.saveFocus(e)}};e.addCommand(t,i),e.ui.addButton(t,{label:e.lang.CMSPlugins.QuicklyInsertImage.button,icon:e.config.CMSPluginUrl+"images/"+t+".png",onRender:function(){e.config.qimId||(e.config.qimId=[]),e.config.qimId.push(this._.id),e.on("instanceReady",(function(){function i(e){if(e){var t=e.match(/(?:formGuid=)([a-z\d-]+)/i),i=e.match(/(?:documentid=)([\d]+)/i),n=e.match(/(?:parentid=)([\d]+)/i);if(t&&n&&/^[a-f\d]{8}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{4}-[a-f\d]{12}$/i.test(t[1])&&parseInt(n[1],10)>=0)return!0;if(i&&parseInt(i[1],10)>=0)return!0}return!1}for(window.InsertImageOrMedia=function(e,t,i,n,a){CMSPlugin.insert(a)},o=0;o<e.config.qimId.length;o++){var n=e.config.qimId[o],a=document.getElementById(n);if(null!==a&&!a.QIM_set)if(a.QIM_set=!0,i(this.config.QuickInsertURL)&&!window.disableQim){a.className+=" CMS_QIM",$cmsj(a).mouseenter((function(){CMSPlugin.currentEditor=e,CMSPlugin.saveFocus(e)})),a.onmousemove=function(){CMSPlugin.currentEditor=e};for(var r,l=a.getElementsByTagName("span"),o=0;o<l.length;o++)l[o].className.indexOf("cke_button_icon")>-1&&(r=l[o]);if(void 0!==r){r.style.position="relative",r.style.background="";var s=document.createElement("div");s.className="InnerDiv",s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.display="inline-block",s.innerHTML='<img src="'+e.config.CMSPluginUrl+"images/"+t+'.png" style="width:16px; height:16px;" />',r.appendChild(s);var u=document.createElement("div");u.className="UploaderDiv",u.style.position="absolute",u.style.top="0px",u.style.width="16px",u.style.height="16px",u.style.visibility="visible",u.style.opacity="1",u.innerHTML='<iframe name="QuickInsertImage" src="'+e.config.QuickInsertURL+"&containerid="+n+'" frameborder="0" marginWidth="0" marginHeight="0" scrolling="no" border="0" style="width:16px; height:16px; overflow:hidden;" allowtransparency="true" ></iframe>',r.appendChild(u);var c=document.createElement("div");c.className="LoadingDiv",c.style.position="absolute",c.style.opacity="1",c.style.display="none",c.style.top="0px",c.style.left="0px",c.innerHTML='<img src="'+e.config.ApplicationPath+'CMSPages/GetResource.ashx?image=Design/Preloaders/preload16.gif" style="width:16px; height:16px;" />',r.appendChild(c);var g=document.createElement("script");g.type="text/javascript",g.src=e.config.ApplicationPath+"CMSModules/Content/Controls/Attachments/DirectFileUploader/DirectFileUploader.js",a.appendChild(g)}}else a.parentNode.removeChild(a)}}))}}),e.on("mode",(function(){if(e.config.qimId)for(var t=0;t<e.config.qimId.length;t++){var i=e.config.qimId[t],n=document.getElementById(i);if(n){var a=n.getElementsByTagName("iframe");"source"==e.mode?(n.className+=" cke_button_disabled",a&&1===a.length&&(a[0].style.display="none")):(n.className=n.className.replace(/\s+cke_button_disabled/gi,""),a&&1===a.length&&(a[0].style.display=""))}}}))},pluginForumButtons:function(e){var t="InsertQuote",i={label:e.lang.CMSPlugins.InsertQuote.button,command:t,icon:e.config.CMSPluginUrl+"images/"+t+".png"},n="InsertImage",a={exec:function(e){var t=prompt(e.lang.CMSPlugins.InsertImage.prompturl,"http://");t&&e.insertHtml("[img]"+t+"[/img]")}},r={label:e.lang.CMSPlugins.InsertImage.button,command:n,icon:e.config.CMSPluginUrl+"images/"+n+".png"},l="InsertUrl",o={exec:function(e){var t=prompt(e.lang.CMSPlugins.InsertUrl.prompturl,"http://");if(t){var i=prompt(e.lang.CMSPlugins.InsertUrl.promptdesc,"");e.insertHtml("[url="+t+"]"+i+"[/url]")}}},s={label:e.lang.CMSPlugins.InsertUrl.button,command:l,icon:e.config.CMSPluginUrl+"images/"+l+".png"};e.ui.addButton(t,i),e.addCommand(t,{exec:function(e){e.insertHtml("[quote=][/quote]")}}),e.ui.addButton(n,r),e.addCommand(n,a),e.ui.addButton(l,s),e.addCommand(l,o)},initMaximalization:function(e){e.on("maximize",(function(t){var i=t.data;if(e.config.sharedSpaces&&i==CKEDITOR.TRISTATE_ON){new CKEDITOR.dom.element(document.body).getCustomData("maximize_saved_styles").class.indexOf("cms-bootstrap")>-1&&(document.body.className+=" cms-bootstrap");var n=$cmsj("#"+e.config.sharedSpaces.top),a=n.offset().top+n.outerHeight();e.container.getChild(1).setStyle("top",a+"px");var r=CKEDITOR.document.getWindow().getViewPaneSize(),l=$cmsj("#"+e.config.sharedSpaces.bottom),o=r.height-a-l.outerHeight();e.resize(r.width,o,null,!0)}}))},initPopupOpener:function(e){e.popup=function(e,t,i,n){CMSPlugin.openModalDialog(e,"CKEditorPopup",t,i,n)}},initContextMenu:function(e){var t={Image:"image",Link:"link",Unlink:"unlink",Flash:"flash",Table:"table"},i=e.config.toolbar instanceof Array?e.config.toolbar:e.config["toolbar_"+e.config.toolbar];if(void 0!==i){for(var n=0;n<i.length;n++){var a=i[n];if(a)for(var r=0;r<a.length;r++){var l=a[r];t[l]&&delete t[l]}}for(var o in t)delete e._.menuItems[t[o]]}},initSelection:function(e){e.on("beforeCommandExec",(function(e){CMSPlugin.saveFocus(e.editor)}))},initDataProcesor:function(e){var t=e.dataProcessor,i=t&&t.dataFilter;i&&i.addRules({elements:{video:function(t){return CMSPlugin.createFakeControl(t,e)},"cke:object":function(t){if(t.attributes.codetype&&"cmsinlinecontrol"==t.attributes.codetype.toLowerCase())return CMSPlugin.createFakeControl(t,e);var i=t.attributes;if(!(i.classid&&String(i.classid).toLowerCase())&&!CMSPlugin.isFlashEmbed(t)){for(var n=0;n<t.children.length;n++)if("cke:embed"==t.children[n].name)return CMSPlugin.isFlashEmbed(t.children[n])?(t.attributes.type="flash",CMSPlugin.createFakeControl(t,e)):null;return null}return t.attributes.type="flash",CMSPlugin.createFakeControl(t,e)},"cke:embed":function(t){var i=null;return CMSPlugin.isFlashEmbed(t)&&(t.attributes.type="flash",i=CMSPlugin.createFakeControl(t,e)),i}}},3)},getInline:function(e,t){var i={};if(e){var n=e.getAttribute("type"),a=e.getAttribute("width"),r=e.getAttribute("height");n&&("media"==n.toLowerCase()&&(n=this.getMediaType(e)),i.cms_type=n);var l=this.getPropertyPrefix(n);if("OBJECT"===e.nodeName&&e.childNodes){a&&(i[l+"width"]=a),r&&(i[l+"height"]=r);for(var o=e.childNodes.length,s=0;s<o;s++){var u=e.childNodes[s],c=u.getAttribute("name"),g=u.getAttribute("value");c&&(i[l+c]=g,l+c==="flash_movie"&&(i.flash_url=g))}}if("VIDEO"===e.nodeName){a&&(i[l+"width"]=a),r&&(i[l+"height"]=r),i[l+"loop"]=e.hasAttribute("loop"),i[l+"autoplay"]=e.hasAttribute("autoplay"),i[l+"controls"]=e.hasAttribute("controls");var d=e.querySelector("source");i[l+"url"]=d&&d.getAttribute("src")}try{if(e=CKEDITOR.dom.element.get(t)){var m=e.getAscendant("a",!0);m&&(i[l+"link"]=m.getAttribute("data-cke-saved-href")||m.getAttribute("href"),i[l+"target"]=m.getAttribute("target"))}}catch(e){}}return i},getPropertyPrefix:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="youtube_";break;case"image":t="img_";break;case"audiovideo":t="av_";break;case"flash":t="flash_"}return t},getInlineType:function(e){var t="";switch(e.toLowerCase()){case"youtubevideo":t="YouTubeVideo";break;case"image":t="Image";break;case"audiovideo":case"flash":t="Media";break;case"widget":t="Widget"}return t},createCKElement:function(e){var t=this.getCurrentEditor();return t?t.document.createElement(e):null},insertInline:function(e,t){if(e){var i=this.getCurrentEditor(),n=this.getPropertyPrefix(e),a=this.getInlineType(e),r=[t[n+"controls"]&&"true"===t[n+"controls"].toLowerCase()?"controls":"",t[n+"autoplay"]&&"true"===t[n+"autoplay"].toLowerCase()?"autoplay":"",t[n+"loop"]&&"true"===t[n+"loop"].toLowerCase()?"loop":""],l='<video height="'+t[n+"height"]+'" width="'+t[n+"width"]+'" '+r.join(" ")+' type="'+a+'">';if(l+='<source src="'+t[n+"url"]+'" type="'+t[n+"mimetype"]+'">',l+="</video>",t.img_link){var o;try{CMSPlugin.restoreFocus(i);var s=i.getSelection();if(s.getType()==CKEDITOR.SELECTION_ELEMENT){var u=s.getSelectedElement();u.is("a")&&(o=u)}var c=s.getRanges(!0)[0];c.shrink(CKEDITOR.SHRINK_TEXT),o=c.getCommonAncestor().getAscendant("a",!0)}catch(e){}if(o){var g={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},d=[];g["data-cke-saved-href"]=t.img_link,t.img_target?g.target=t.img_target:d.push("target"),o.setAttributes(g),o.removeAttributes(d),o.setHtml(l),l=o.getOuterHtml()}else{var m='<a href="'+t.img_link+'" ';t.img_target&&(m+='target="'+t.img_target+'" '),l=(m+=">")+l+"</a>"}}else i.document.$.execCommand("unlink",!1,null);this.insertHtml(l)}},insertLink:function(e){var t={href:"javascript:void(0)/*"+CKEDITOR.tools.getNextNumber()+"*/"},i=[],n=this.getCurrentEditor(),a=null,r=null,l=null,o=null;try{if(CMSPlugin.restoreFocus(n),(v=n.getSelection()).getType()==CKEDITOR.SELECTION_ELEMENT){var s=v.getSelectedElement();s.is("a")&&(a=s)}(y=v.getRanges(!0)[0]).shrink(CKEDITOR.SHRINK_TEXT),a=y.getCommonAncestor().getAscendant("a",!0)}catch(e){}if(e.link_url){var u=e.link_protocol||"",c=e.link_url||"";t["data-cke-saved-href"]=0===c.indexOf("/")?c:u+c}else if(e.anchor_name)r=e.anchor_name||"",l=e.anchor_custom||"",o=e.anchor_id||"",t["data-cke-saved-href"]="#"+(r||l||o||"");else if(e.email_to){var g=e.email_cc,d=e.email_bcc,m=e.email_subject,h=e.email_body,f=[];g&&f.push("cc="+g),d&&f.push("bcc="+d),m&&f.push("subject="+m),h&&f.push("body="+h),f=f.length?"?"+f.join("&"):"",t["data-cke-saved-href"]="mailto:"+e.email_to+f}if(e.link_target?t.target=e.link_target:i.push("target"),e.link_url){var p=function(e,n,a){var r=e[n];r?t[a]=r:i.push(a)};p(e,"link_url","href"),p(e,"link_id","id"),p(e,"link_target","target"),p(e,"link_class","class"),p(e,"link_tooltip","title"),p(e,"link_style","style"),e.link_name?(t.name=t["data-cke-saved-name"]=e.link_name,t.class=(t.class?t.class+" ":"")+"cke_anchor"):i=i.concat(["data-cke-saved-name","name"])}if(a){var b=a;b.setAttributes(t),b.removeAttributes(i),b.getAttribute("name")?b.addClass("cke_anchor"):b.removeClass("cke_anchor"),this.fakeObj&&n.createFakeElement(b,"cke_anchor","anchor").replace(this.fakeObj),delete a}else{var C,_,v=n.getSelection(),k=v.getRanges(!0),y=k[0];if(1==k.length&&y.collapsed&&(C=new CKEDITOR.dom.text(e.email_linktext?e.email_linktext:e.email_to?e.email_to:e.anchor_linktext?e.anchor_linktext:e.anchor_name?e.anchor_name:e.link_text?e.link_text:e.link_url,n.document),k[0].insertNode(C),k[0].selectNodeContents(C),v.selectRanges(k)),(_=new CKEDITOR.style({element:"a",attributes:t})).type=CKEDITOR.STYLE_INLINE,_.applyToRange(y),e.link_id)for(var I=n.document.$.getElementsByTagName("a"),M=0;M<I.length;M++)if(I[M].getAttribute("href")==t.href){I[M].id=e.link_id;break}}},insertImage:function(e){var t=this.createCKElement("img");if(null!=t){if(e.img_id&&(t.$.id=e.img_id),e.img_url&&(t.$.src=e.img_url,t.$.setAttribute("data-cke-saved-src",e.img_url)),e.img_alt?t.$.alt=e.img_alt:e.img_tooltip?t.$.alt=e.img_tooltip:t.$.alt="",e.img_tooltip&&(t.$.title=e.img_tooltip),e.img_class&&t.$.setAttribute("class",e.img_class),e.img_dir&&(t.$.dir=e.img_dir),e.img_usemap&&(t.$.useMap=e.img_usemap),e.img_longdescription&&t.$.setAttribute("longdesc",e.img_longdescription),e.img_lang&&(t.$.lang=e.img_lang),e.img_style&&(t.setAttribute("style",e.img_style),null!=t.$.style.cssStyle&&(t.$.style.cssStyle=e.img_style),null!=t.$.style.cssText&&(t.$.style.cssText=e.img_style)),e.img_width&&parseInt(e.img_width,10)>0&&t.setAttribute("width",parseInt(e.img_width,10)+"px"),e.img_height&&parseInt(e.img_height,10)>0&&t.setAttribute("height",parseInt(e.img_height,10)+"px"),e.img_borderwidth&&parseInt(e.img_borderwidth,10)>=0&&(t.$.style.borderWidth=e.img_borderwidth+"px",t.$.style.borderStyle="solid"),e.img_bordercolor)try{t.$.style.borderColor=e.img_bordercolor}catch(e){t.$.style.borderColor=""}if(e.img_align&&("left"==e.img_align||"right"==e.img_align?(null!=t.$.style.cssFloat&&(t.$.style.cssFloat=e.img_align),null!=t.$.style.styleFloat&&(t.$.style.styleFloat=e.img_align)):(null!=t.$.style.verticalAlign&&(t.$.style.verticalAlign=e.img_align),null!=t.$.style["vartical-align"]&&(t.$.style["vartical-align"]=e.img_align))),e.img_vspace||e.img_hspace){var i=parseInt(e.img_vspace,10),n=parseInt(e.img_hspace,10);i==n&&i>=0?t.$.style.margin=n+"px":i==n&&-1==i||(t.$.style.margin=(i>=0?i+"px ":"auto ")+(n>=0?n+"px":"auto"))}if(e.img_link||e.img_behavior){var a=this.createCKElement("a");e.img_link&&(a.$.href=e.img_link,a.$.setAttribute("data-cke-saved-href",e.img_link)),e.img_target?a.$.setAttribute("target",e.img_target):e.img_behavior&&a.$.setAttribute("target",e.img_behavior),a.append(t),this.insertElement(a)}else this.insertElement(t)}},insertHtml:function(e){var t=this.getCurrentEditor();t&&(CMSPlugin.restoreFocus(t),t.insertHtml(e))},insertElement:function(e){var t=this.getCurrentEditor();t&&(CMSPlugin.restoreFocus(t),t.insertElement(e))},insert:function(e){if(e){var t=e.cms_type;t?this.insertInline(t,e):e.link_url||e.email_to||e.anchor_name?this.insertLink(e):e.img_url&&this.insertImage(e)}},saveFocus:function(e){CMSPlugin.selection=e.getSelection(),CMSPlugin.selection?(CMSPlugin.selectedElement=CMSPlugin.selection.getSelectedElement(),CMSPlugin.selectionBookmarks=CMSPlugin.selection.createBookmarks2()):(CMSPlugin.selectedElement=null,CMSPlugin.selectionBookmarks=null)},restoreFocus:function(e){CMSPlugin.selection?CMSPlugin.selectionBookmarks?CMSPlugin.selection.selectBookmarks(CMSPlugin.selectionBookmarks):CMSPlugin.selectedElement?CMSPlugin.selection.selectElement(CMSPlugin.selectedElement):e.focus():e.focus()},openModalDialog:function(e,t,i,n,a){window.modalDialog(e,t,i,n,a)},beforeInit:function(e){this.pluginKeyPress(e)},init:function(e){this.initCss(e),this.initMaximalization(e),this.initSelection(e),this.pluginInsertMacro(e),this.pluginInsertImageOrMedia(e),this.pluginInsertLink(e),this.pluginQuicklyInsertMedia(e),this.pluginForumButtons(e)},afterInit:function(e){this.initContextMenu(e),this.initDataProcesor(e),this.initPopupOpener(e)}};CKEDITOR.plugins.add("CMSPlugins",CMSPlugin);